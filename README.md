# 标普500市场回调研究项目

## 项目概述

本项目旨在深入研究标普500指数在过去30年的市场回调行为，并探索在市场波动期间的最优仓位管理策略。通过量化分析和可视化展示，为投资者提供数据驱动的决策参考。

## 研究目标

- **识别历史回调模式**：系统性地识别和分析标普500在过去30年中所有超过10%的市场回调
- **优化仓位管理**：探索在市场回调期间调整仓位的最优策略，以最大化长期收益
- **策略回测对比**：将动态仓位管理策略与传统的买入持有策略进行对比分析

---

## 任务一：历史回调统计与分析

### 研究目标
统计美股股票市场（标普500）在过去30年（1995-2025）中所有超过10%的市场回调事件，并进行深入分析。

### 具体内容

1. **回调识别**
   - 识别所有从峰值下跌超过10%的回调事件
   - 记录每次回调的关键指标：
     - 回调开始日期（峰值日期）
     - 回调结束日期（谷底日期）
     - 回调幅度（百分比）
     - 回调持续时间（天数）
     - 恢复到峰值所需时间

2. **数据分析**
   - 回调频率统计
   - 平均回调幅度
   - 平均持续时间
   - 回调深度分布（10-20%, 20-30%, 30%+）
   - 历史重大股灾事件标注

3. **可视化展示**
   - 标普500价格走势图（标注所有回调区间）
   - 回调幅度分布柱状图
   - 回调持续时间箱线图
   - 回调频率时间线
   - 恢复时间统计图

4. **研究结论**
   - 在报告顶部撰写：
     - 过去30年共发生多少次10%+回调
     - 回调的典型特征（频率、幅度、持续时间）
     - 市场恢复能力分析
     - 对投资者的启示

### 输出文件
- `task1_analysis.html` - 完整的分析报告（包含图表和结论）
- `task1_drawdowns.csv` - 回调事件详细数据

---

## 任务二：动态仓位管理策略回测

### 研究背景
假设投资者在股灾到来前持有100%标普500仓位。本研究探索：当市场开始回调时，如何动态调整仓位以获得最优收益。

### 研究方法

1. **基准策略（Benchmark）**
   - Buy and Hold：始终持有100%标普500仓位
   - 作为对比基准

2. **动态调整策略**
   研究以下仓位调整方案：
   
   - **策略A - 固定减仓法**
     - 回调5%时减仓至80%
     - 回调10%时减仓至60%
     - 回调15%时减仓至40%
     - 回调20%+时减仓至20%
   
   - **策略B - 渐进加仓法**
     - 初始持仓100%
     - 回调开始后立即减至50%
     - 回调触底后分批加仓
     - 根据反弹幅度逐步恢复到100%
   
   - **策略C - 动态对冲法**
     - 使用移动止损
     - 根据波动率调整仓位
     - VIX指数联动策略
   
   - **策略D - 自定义优化策略**
     - 基于机器学习或量化模型
     - 多因子决策系统

3. **回测设置**
   - 时间区间：上次重大股灾结束至今
   - 初始资金：$100,000
   - 交易成本：考虑0.1%的交易摩擦成本
   - 再平衡频率：每日检查，触发条件时调整

4. **评估指标**
   - 累计收益率
   - 年化收益率
   - 最大回撤
   - 夏普比率
   - 卡尔马比率
   - 胜率
   - 风险调整后收益

### 可视化展示

1. **策略对比图表**
   - 累计收益曲线对比（多条策略 vs Benchmark）
   - 回撤对比图
   - 仓位变化时间序列
   - 滚动收益率对比

2. **风险收益分析**
   - 风险收益散点图
   - 年度收益对比柱状图
   - 策略表现综合评分雷达图

3. **详细分析**
   - 每次调仓时点标注
   - 盈亏分布直方图
   - 策略表现统计表

### 研究结论

在报告顶部撰写：
- 各策略的收益与风险对比
- 最优仓位调整策略推荐
- 动态管理相比Buy and Hold的优劣势
- 不同市场环境下的策略适用性
- 实战建议与风险提示

### 输出文件
- `task2_backtest.html` - 完整的回测报告（包含图表和结论）
- `task2_performance.csv` - 各策略表现数据
- `task2_trades.csv` - 详细交易记录

---

## 技术栈

### 数据获取
- `yfinance` - 获取标普500历史数据
- `pandas-datareader` - 备用数据源

### 数据处理与分析
- `pandas` - 数据处理
- `numpy` - 数值计算
- `scipy` - 统计分析

### 可视化
- `matplotlib` - 基础图表
- `plotly` - 交互式图表
- `seaborn` - 统计可视化

### 回测框架
- `backtrader` / `vectorbt` - 策略回测
- 自定义回测引擎

---

## 项目结构

```
sp500-research/
│
├── README.md                      # 项目说明文档
├── requirements.txt               # Python依赖包
│
├── data/                          # 数据目录
│   ├── sp500_raw.csv             # 原始数据
│   └── sp500_processed.csv       # 处理后的数据
│
├── task1_drawdown_analysis/       # 任务一：回调分析
│   ├── drawdown_analyzer.py      # 回调识别与分析脚本
│   ├── visualization.py          # 可视化脚本
│   └── report_generator.py       # 报告生成脚本
│
├── task2_position_strategy/       # 任务二：仓位管理
│   ├── strategy_definitions.py   # 策略定义
│   ├── backtester.py            # 回测引擎
│   ├── performance_metrics.py   # 性能评估
│   └── report_generator.py      # 报告生成脚本
│
├── utils/                         # 工具函数
│   ├── data_loader.py           # 数据加载
│   └── helper_functions.py      # 辅助函数
│
├── outputs/                       # 输出目录
│   ├── task1_analysis.html
│   ├── task1_drawdowns.csv
│   ├── task2_backtest.html
│   ├── task2_performance.csv
│   └── task2_trades.csv
│
└── notebooks/                     # Jupyter笔记本（可选）
    ├── task1_exploration.ipynb
    └── task2_exploration.ipynb
```

---

## 安装与运行

### 1. 环境准备

```bash
# 克隆项目
git clone <repository-url>
cd sp500-research

# 创建虚拟环境（推荐）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt
```

### 2. 运行任务一

```bash
# 运行回调分析
python task1_drawdown_analysis/drawdown_analyzer.py

# 生成可视化报告
python task1_drawdown_analysis/report_generator.py
```

### 3. 运行任务二

```bash
# 运行回测
python task2_position_strategy/backtester.py

# 生成对比报告
python task2_position_strategy/report_generator.py
```

### 4. 查看结果

所有输出文件将保存在 `outputs/` 目录下，用浏览器打开HTML文件查看交互式报告。

---

## 主要依赖包

```
yfinance>=0.2.28
pandas>=2.0.0
numpy>=1.24.0
matplotlib>=3.7.0
plotly>=5.14.0
seaborn>=0.12.0
scipy>=1.10.0
backtrader>=1.9.78
```

---

## 研究方法论

### 回调定义
- **回调（Drawdown）**：从历史峰值到后续谷底的下跌幅度
- **10%回调阈值**：从峰值下跌至少10%才被计入统计
- **峰值识别**：使用滚动窗口方法识别局部高点

### 策略评估框架
- **绝对收益**：策略的总回报率
- **风险调整收益**：夏普比率、索提诺比率
- **下行风险**：最大回撤、回撤深度分布
- **稳定性**：收益波动率、胜率

---

## 注意事项

1. **数据质量**：确保获取完整的30年历史数据，处理缺失值和异常值
2. **交易成本**：回测中需考虑实际交易摩擦成本
3. **过拟合风险**：避免过度优化策略参数
4. **市场环境变化**：历史表现不代表未来收益
5. **实施可行性**：考虑策略的实际可操作性

---

## 未来扩展方向

- [ ] 加入其他指数对比分析（纳斯达克、道琼斯）
- [ ] 探索行业轮动策略
- [ ] 引入宏观经济指标（利率、通胀等）
- [ ] 机器学习预测模型
- [ ] 实时监控系统
- [ ] 组合优化与资产配置

---

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。

---

## 许可证

MIT License

---

## 联系方式

如有问题或建议，请通过以下方式联系：
- GitHub Issues
- Email: [your-email@example.com]

---

## 免责声明

本项目仅供学术研究和教育目的使用。所有分析结果不构成投资建议。投资有风险，决策需谨慎。过往表现不代表未来收益。使用本项目进行实际投资决策的风险由用户自行承担。

---

**最后更新**: 2025年2月
